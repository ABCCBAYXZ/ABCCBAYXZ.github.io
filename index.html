<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Helfer</title>
    <style>
        body{font-family:sans-serif;background-color:#f0f0f0;margin:0;padding:20px}.container{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;padding:20px}.bingo-card{width:350px;padding:15px;border:2px solid #ccc;border-radius:10px;background-color:#fff;box-shadow:0 4px 8px rgba(0,0,0,.1);transition:border-color .3s,box-shadow .3s}.bingo-card h2{text-align:center;margin-top:0;letter-spacing:5px}.card-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;text-align:center}.header-cell,.number-cell{padding:10px 5px;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:1.2em;font-weight:700;width:50px;height:50px;margin:0 auto}.header-cell{background-color:#4caf50;color:#fff}.number-cell{background-color:#e9e9e9;cursor:pointer;transition:background-color .2s;position:relative}.card-footer{margin-top:20px;text-align:center;font-size:1.1em;font-weight:700}.card-footer span{margin:0 10px}.bingo-card.has-bingo{border-color:#4caf50;box-shadow:0 0 15px 5px rgba(76,175,80,.7)}.number-cell.marked{background-color:#ffc107;border:2px solid #e65100;color:transparent;-webkit-user-select:none;user-select:none}.number-cell.marked::after{content:"✕";color:#c0392b;font-size:2.8em;font-weight:700;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);line-height:1}.input-area{background-color:#fff;padding:20px;margin:0 auto 20px auto;max-width:600px;border-radius:10px;box-shadow:0 4px 8px rgba(0,0,0,.1);text-align:center}.input-area form{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;gap:10px}.input-area label{font-weight:700;font-size:1.1em}.input-area input[type=number]{width:80px;padding:10px;border-radius:5px;border:1px solid #ccc;font-size:1.2em;text-align:center}.input-area button{padding:10px 20px;border-radius:5px;border:none;background-color:#4caf50;color:#fff;font-size:1.1em;cursor:pointer}.input-area button:hover{background-color:#45a049}#add-ticket-btn{background-color:#007bff}.last-number{margin-top:15px;font-size:1.1em}#last-number-display{font-weight:700;color:#c0392b;font-size:1.3em;padding:5px 10px;background-color:#f0f0f0;border-radius:5px}
    </style>
</head>
<body>

    <div class="input-area">
        <form id="number-form">
            <label for="number-input">Gezogene Zahl:</label>
            <input type="number" id="number-input" min="1" max="75" required autofocus>
            <button type="submit">Ankreuzen</button>
            <button type="button" id="add-ticket-btn">Los hinzufügen</button>
        </form>
        <div class="last-number">
            Zuletzt: <span id="last-number-display">-</span>
        </div>
    </div>

    <!-- Der Container ist beim Start leer -->
    <div class="container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Das Array der Start-Lose ist jetzt leer.
            const initialTicketsData = [];

            const container = document.querySelector('.container');
            const numberForm = document.getElementById('number-form');
            const numberInput = document.getElementById('number-input');
            const lastNumberDisplay = document.getElementById('last-number-display');
            const addTicketBtn = document.getElementById('add-ticket-btn');

            const winPatterns = [
                [0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],
                [0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],
                [0,6,12,18,24],[4,8,12,16,20]
            ];
            
            function createTicketElement(ticketData) {
                const card = document.createElement('div');
                card.className = 'bingo-card';

                let numbersHtml = ticketData.zahlen.map(num => `<div class="number-cell" data-number="${num}">${num}</div>`).join('');

                card.innerHTML = `
                    <h2>BINGO!</h2>
                    <div class="card-grid">
                        <div class="header-cell">B</div><div class="header-cell">I</div><div class="header-cell">N</div><div class="header-cell">G</div><div class="header-cell">O</div>
                        ${numbersHtml}
                    </div>
                    <div class="card-footer">
                        <span>Serie: ${ticketData.serie}</span>
                        <span class="los-nr">Los-Nr.: ${ticketData.losNr}</span>
                    </div>
                `;
                card.querySelectorAll('.number-cell').forEach(cell => cell.addEventListener('click', handleCellClick));
                return card;
            }

            function populateInitialTickets() {
                initialTicketsData.forEach(ticket => {
                    const ticketElement = createTicketElement(ticket);
                    container.appendChild(ticketElement);
                });
            }

            numberForm.addEventListener('submit', (event) => {
                event.preventDefault();
                const numberToMark = numberInput.value;
                if (numberToMark) {
                    document.querySelectorAll(`.number-cell[data-number="${numberToMark}"]`).forEach(cell => cell.classList.add('marked'));
                    lastNumberDisplay.textContent = numberToMark;
                    checkForBingo();
                    numberInput.value = '';
                    numberInput.focus();
                }
            });

            addTicketBtn.addEventListener('click', () => {
                const inputJson = prompt("Bitte Los-Daten im JSON-Format einfügen:", '{\n  "serie": "xxxx",\n  "losNr": "xxxxx",\n  "zahlen": [ ... ]\n}');
                if (!inputJson) return;

                try {
                    let data = JSON.parse(inputJson);
                    if (!Array.isArray(data)) {
                        data = [data];
                    }

                    data.forEach(ticketData => {
                        if (ticketData.serie && ticketData.losNr && Array.isArray(ticketData.zahlen) && ticketData.zahlen.length === 25) {
                            const newTicket = createTicketElement(ticketData);
                            container.appendChild(newTicket);
                        } else {
                            alert("Fehler: Ein Los hat ein ungültiges Format und wurde nicht hinzugefügt.");
                        }
                    });
                } catch (error) {
                    alert("Ungültiges JSON-Format! Bitte überprüfen Sie Ihre Eingabe.");
                }
            });

            function handleCellClick(event) {
                const clickedNumber = event.target.dataset.number;
                document.querySelectorAll(`.number-cell[data-number="${clickedNumber}"]`).forEach(cell => cell.classList.toggle('marked'));
                checkForBingo();
            }
            
            function checkForBingo() {
                document.querySelectorAll('.bingo-card').forEach(card => {
                    const cellsOnCard = card.querySelectorAll('.number-cell');
                    let previousBingoCount = parseInt(card.dataset.bingoCount || '0');
                    let currentBingoCount = 0;
                    for (const pattern of winPatterns) {
                        if (pattern.every(index => cellsOnCard[index].classList.contains('marked'))) {
                            currentBingoCount++;
                        }
                    }
                    if (currentBingoCount > previousBingoCount) {
                        const losNummer = card.querySelector('.los-nr').textContent;
                        let message = (currentBingoCount === 1) ? `BINGO auf ${losNummer}!` : `${currentBingoCount}-fach BINGO auf ${losNummer}!`;
                        setTimeout(() => alert(message), 100);
                        card.dataset.bingoCount = currentBingoCount;
                        card.classList.add('has-bingo');
                    }
                });
            }

            populateInitialTickets();
        });
    </script>

</body>
</html>
